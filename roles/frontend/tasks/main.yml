---
- name: set the facts for host
  set_fact:
   public_dns_name: "{{ hostvars['localhost']frontend.results[item.0]['instances'][0]['public_dns_name'] }}"
   backend_private_ip: "{{ hostvars['localhost']backend.results[item.0]['instances'][0]['private_ip'] }}"

- name: update apt repo
  action: apt update-cache=yes

- name: install nginx
  action: apt name=nginx state=installed

- name: service nginx
  action: service name=nginx state=started

- name: Setup nginx conf
  template:
   src=wordpress.conf.j2
   dest=/etc/nginx/sites-available/wordpress.conf

- name: Create symlink to configuration file
  file:
   src: "/etc/nginx/sites-available/wordpress.conf"
   dest: "/etc/nginx/sites-enabled/wordpress.conf"
   state: link

- name: restart nginx
  service:
   name: nginx
   state: restarted
